{% extends "base.html" %}

{% block title %}–ö–≤–µ—Å—Ç—ã - –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è —Ä–æ–±–æ—Ç–æ—Ç–µ—Ö–Ω–∏–∫–∏{% endblock %}

{% block content %}
<div class="quests-page">
    <div class="page-header">
        <h1>üéØ –ö–≤–µ—Å—Ç—ã –∏ –æ–±—É—á–µ–Ω–∏–µ</h1>
        
        {% if user and user.role == 'admin' %}
        <p class="page-subtitle">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–±—É—á–∞—é—â–∏–º–∏ –∫–≤–µ—Å—Ç–∞–º–∏ –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</p>
        {% else %}
        <p class="page-subtitle">–û—Å–≤–æ–π—Ç–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏–∏ —á–µ—Ä–µ–∑ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞–Ω–∏—è</p>
        {% endif %}
    </div>

    <!-- –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–≤–µ—Å—Ç–∞–º–∏ -->
    {% if user and user.role == 'admin' %}
    <div class="admin-panel">
        <div class="admin-header">
            <h2><i class="fas fa-user-shield"></i> –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–≤–µ—Å—Ç–∞–º–∏</h2>
            <div class="admin-stats">
                <span class="admin-badge">–í—Å–µ–≥–æ –∫–≤–µ—Å—Ç–æ–≤: 4</span>
                <span class="admin-badge">–ê–∫—Ç–∏–≤–Ω—ã—Ö: 3</span>
                <span class="admin-badge">–í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ: 1</span>
            </div>
        </div>
        
        <div class="admin-controls">
            <button class="btn btn-admin" onclick="showAddQuestModal()">
                <i class="fas fa-plus"></i> –°–æ–∑–¥–∞—Ç—å –∫–≤–µ—Å—Ç
            </button>
            <button class="btn btn-admin" onclick="showUserProgressModal()">
                <i class="fas fa-chart-line"></i> –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
            </button>
            <button class="btn btn-admin" onclick="exportQuestData()">
                <i class="fas fa-file-export"></i> –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
            </button>
        </div>
    </div>
    {% endif %}

    <div class="quests-container">
        <!-- –ö–≤–µ—Å—Ç 1 -->
        <div class="quest-card completed">
            {% if user.role == 'admin' %}
            <div class="admin-quest-overlay">
                <div class="admin-quest-controls">
                    <button class="btn btn-sm btn-edit" onclick="editQuest(1)" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–≤–µ—Å—Ç">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-sm btn-stats" onclick="showQuestStats(1)" title="–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–≤–µ—Å—Ç–∞">
                        <i class="fas fa-chart-bar"></i>
                    </button>
                    <button class="btn btn-sm btn-users" onclick="showQuestUsers(1)" title="–£—á–∞—Å—Ç–Ω–∏–∫–∏ –∫–≤–µ—Å—Ç–∞">
                        <i class="fas fa-users"></i>
                    </button>
                </div>
                <div class="quest-admin-badge active">
                    –ê–∫—Ç–∏–≤–µ–Ω ‚Ä¢ 45 —Å—Ç—É–¥–µ–Ω—Ç–æ–≤
                </div>
            </div>
            {% else %}
            <div class="quest-user-badge completed">
                ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ
            </div>
            {% endif %}
            
            <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∫–≤–µ—Å—Ç–∞ -->
            <div class="quest-header">
                <div class="quest-icon" style="background: #4CAF50;">
                    üñ®Ô∏è
                </div>
                <div class="quest-main">
                    <h3>–û—Å–Ω–æ–≤—ã 3D-–ø–µ—á–∞—Ç–∏</h3>
                    <p class="quest-description">–ò–∑—É—á–∏—Ç–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã —Ä–∞–±–æ—Ç—ã 3D-–ø—Ä–∏–Ω—Ç–µ—Ä–∞ –∏ —Å–æ–∑–¥–∞–π—Ç–µ —Å–≤–æ—é –ø–µ—Ä–≤—É—é –º–æ–¥–µ–ª—å</p>
                    <div class="quest-meta">
                        <span class="meta-item"><i class="fas fa-clock"></i> 2-3 —á–∞—Å–∞</span>
                        <span class="meta-item"><i class="fas fa-tasks"></i> 4 –∑–∞–¥–∞–Ω–∏—è</span>
                        {% if user.role == 'admin' %}
                        <span class="meta-item"><i class="fas fa-users"></i> 45 —Å—Ç—É–¥–µ–Ω—Ç–æ–≤</span>
                        <span class="meta-item"><i class="fas fa-chart-line"></i> 92% —É—Å–ø–µ—Ö–∞</span>
                        {% endif %}
                    </div>
                </div>
            </div>
            
            <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å –∫–≤–µ—Å—Ç–∞ -->
            <div class="quest-progress">
                <div class="progress-info">
                    <span>–ü—Ä–æ–≥—Ä–µ—Å—Å:</span>
                    <strong>
                        {% if user.role == 'admin' %}
                            92% —É—Å–ø–µ—Ö–∞
                        {% else %}
                            100%
                        {% endif %}
                    </strong>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: {% if user.role == 'admin' %}92{% else %}100{% endif %}%; background: #4CAF50;"></div>
                </div>
            </div>

            <!-- –ó–∞–¥–∞–Ω–∏—è –∫–≤–µ—Å—Ç–∞ -->
            <div class="quest-tasks">
                <h4>–ó–∞–¥–∞–Ω–∏—è –∫–≤–µ—Å—Ç–∞:</h4>
                <div class="tasks-grid">
                    <!-- –ó–∞–¥–∞–Ω–∏–µ 1 -->
                    <div class="task-item reading completed" {% if user.role != 'admin' %}onclick="openTask('/quest/1/task/1')"{% endif %}>
                        <div class="task-icon">
                            <i class="fas fa-book"></i>
                        </div>
                        <div class="task-info">
                            <div class="task-name">–û—Å–Ω–æ–≤—ã 3D-–ø–µ—á–∞—Ç–∏</div>
                            <div class="task-status">
                                {% if user.role == 'admin' %}
                                <span class="task-stats">95% –∑–∞–≤–µ—Ä—à–µ–Ω–æ</span>
                                {% else %}
                                <i class="fas fa-check"></i> –ó–∞–≤–µ—Ä—à–µ–Ω–æ
                                {% endif %}
                            </div>
                        </div>
                        {% if user.role == 'admin' %}
                        <div class="task-admin-actions">
                            <button class="btn btn-xs btn-edit" onclick="editTask(1)" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–¥–∞–Ω–∏–µ">
                                <i class="fas fa-edit"></i>
                            </button>
                        </div>
                        {% endif %}
                    </div>

                    <!-- –ó–∞–¥–∞–Ω–∏–µ 2 -->
                    <div class="task-item quiz completed" {% if user.role != 'admin' %}onclick="openTask('/quest/1/task/2')"{% endif %}>
                        <div class="task-icon">
                            <i class="fas fa-question-circle"></i>
                        </div>
                        <div class="task-info">
                            <div class="task-name">–¢–µ—Å—Ç –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏</div>
                            <div class="task-status">
                                {% if user.role == 'admin' %}
                                <span class="task-stats">88% –∑–∞–≤–µ—Ä—à–µ–Ω–æ</span>
                                {% else %}
                                <i class="fas fa-check"></i> –ó–∞–≤–µ—Ä—à–µ–Ω–æ
                                {% endif %}
                            </div>
                        </div>
                        {% if user.role == 'admin' %}
                        <div class="task-admin-actions">
                            <button class="btn btn-xs btn-edit" onclick="editTask(2)" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–¥–∞–Ω–∏–µ">
                                <i class="fas fa-edit"></i>
                            </button>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- –§—É—Ç–µ—Ä –∫–≤–µ—Å—Ç–∞ -->
            <div class="quest-footer">
                <div class="quest-rewards">
                    <strong><i class="fas fa-trophy"></i> –ù–∞–≥—Ä–∞–¥—ã:</strong>
                    <span>–î–æ–ø—É—Å–∫ –∫ 3D-–ø—Ä–∏–Ω—Ç–µ—Ä–∞–º, +100 –æ–ø—ã—Ç–∞</span>
                </div>
                {% if user.role != 'admin' %}
                <button class="btn btn-primary" onclick="continueQuest(1)">
                    <i class="fas fa-redo"></i> –ü–æ–≤—Ç–æ—Ä–∏—Ç—å
                </button>
                {% endif %}
            </div>
        </div>

        <!-- –ö–≤–µ—Å—Ç 2 -->
        <div class="quest-card">
            {% if user.role == 'admin' %}
            <div class="admin-quest-overlay">
                <div class="admin-quest-controls">
                    <button class="btn btn-sm btn-edit" onclick="editQuest(2)" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–≤–µ—Å—Ç">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-sm btn-stats" onclick="showQuestStats(2)" title="–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–≤–µ—Å—Ç–∞">
                        <i class="fas fa-chart-bar"></i>
                    </button>
                    <button class="btn btn-sm btn-users" onclick="showQuestUsers(2)" title="–£—á–∞—Å—Ç–Ω–∏–∫–∏ –∫–≤–µ—Å—Ç–∞">
                        <i class="fas fa-users"></i>
                    </button>
                </div>
                <div class="quest-admin-badge active">
                    –ê–∫—Ç–∏–≤–µ–Ω ‚Ä¢ 32 —Å—Ç—É–¥–µ–Ω—Ç–æ–≤
                </div>
            </div>
            {% else %}
            <div class="quest-user-badge active">
                üî• –ê–∫—Ç–∏–≤–Ω–æ
            </div>
            {% endif %}
            
            <div class="quest-header">
                <div class="quest-icon" style="background: #2196F3;">
                    ü§ñ
                </div>
                <div class="quest-main">
                    <h3>–ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–æ–±–æ—Ç–æ–≤</h3>
                    <p class="quest-description">–û—Å–≤–æ–π—Ç–µ –±–∞–∑–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è —Ä–æ–±–æ—Ç–æ–≤-–º–∞–Ω–∏–ø—É–ª—è—Ç–æ—Ä–æ–≤</p>
                    <div class="quest-meta">
                        <span class="meta-item"><i class="fas fa-clock"></i> 3-4 —á–∞—Å–∞</span>
                        <span class="meta-item"><i class="fas fa-tasks"></i> 5 –∑–∞–¥–∞–Ω–∏–π</span>
                        {% if user.role == 'admin' %}
                        <span class="meta-item"><i class="fas fa-users"></i> 32 —Å—Ç—É–¥–µ–Ω—Ç–æ–≤</span>
                        <span class="meta-item"><i class="fas fa-chart-line"></i> 78% —É—Å–ø–µ—Ö–∞</span>
                        {% endif %}
                    </div>
                </div>
            </div>
            
            <div class="quest-progress">
                <div class="progress-info">
                    <span>–ü—Ä–æ–≥—Ä–µ—Å—Å:</span>
                    <strong>
                        {% if user.role == 'admin' %}
                            78% —É—Å–ø–µ—Ö–∞
                        {% else %}
                            75%
                        {% endif %}
                    </strong>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: {% if user.role == 'admin' %}78{% else %}75{% endif %}%; background: #2196F3;"></div>
                </div>
            </div>

            <div class="quest-tasks">
                <h4>–ó–∞–¥–∞–Ω–∏—è –∫–≤–µ—Å—Ç–∞:</h4>
                <div class="tasks-grid">
                    <!-- –ó–∞–¥–∞–Ω–∏–µ 1 -->
                    <div class="task-item reading completed" {% if user.role != 'admin' %}onclick="openTask('/quest/2/task/1')"{% endif %}>
                        <div class="task-icon">
                            <i class="fas fa-book"></i>
                        </div>
                        <div class="task-info">
                            <div class="task-name">–û—Å–Ω–æ–≤—ã —Ä–æ–±–æ—Ç–æ—Ç–µ—Ö–Ω–∏–∫–∏</div>
                            <div class="task-status">
                                {% if user.role == 'admin' %}
                                <span class="task-stats">85% –∑–∞–≤–µ—Ä—à–µ–Ω–æ</span>
                                {% else %}
                                <i class="fas fa-check"></i> –ó–∞–≤–µ—Ä—à–µ–Ω–æ
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <!-- –ó–∞–¥–∞–Ω–∏–µ 2 -->
                    <div class="task-item practical active" {% if user.role != 'admin' %}onclick="openTask('/quest/2/task/2')"{% endif %}>
                        <div class="task-icon">
                            <i class="fas fa-wrench"></i>
                        </div>
                        <div class="task-info">
                            <div class="task-name">–ü—Ä–∞–∫—Ç–∏–∫–∞ —Å –º–∞–Ω–∏–ø—É–ª—è—Ç–æ—Ä–æ–º</div>
                            <div class="task-status">
                                {% if user.role == 'admin' %}
                                <span class="task-stats">65% –∑–∞–≤–µ—Ä—à–µ–Ω–æ</span>
                                {% else %}
                                <i class="fas fa-play"></i> –ê–∫—Ç–∏–≤–Ω–æ
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="quest-footer">
                <div class="quest-rewards">
                    <strong><i class="fas fa-trophy"></i> –ù–∞–≥—Ä–∞–¥—ã:</strong>
                    <span>–î–æ–ø—É—Å–∫ –∫ —Ä–æ–±–æ—Ç–∞–º-–º–∞–Ω–∏–ø—É–ª—è—Ç–æ—Ä–∞–º, +150 –æ–ø—ã—Ç–∞</span>
                </div>
                {% if user.role != 'admin' %}
                <button class="btn btn-primary" onclick="continueQuest(2)">
                    <i class="fas fa-play"></i> –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å
                </button>
                {% endif %}
            </div>
        </div>

        <!-- –ö–≤–µ—Å—Ç 3 -->
        <div class="quest-card">
            {% if user.role == 'admin' %}
            <div class="admin-quest-overlay">
                <div class="admin-quest-controls">
                    <button class="btn btn-sm btn-edit" onclick="editQuest(3)" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–≤–µ—Å—Ç">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-sm btn-stats" onclick="showQuestStats(3)" title="–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–≤–µ—Å—Ç–∞">
                        <i class="fas fa-chart-bar"></i>
                    </button>
                    <button class="btn btn-sm btn-users" onclick="showQuestUsers(3)" title="–£—á–∞—Å—Ç–Ω–∏–∫–∏ –∫–≤–µ—Å—Ç–∞">
                        <i class="fas fa-users"></i>
                    </button>
                </div>
                <div class="quest-admin-badge active">
                    –ê–∫—Ç–∏–≤–µ–Ω ‚Ä¢ 28 —Å—Ç—É–¥–µ–Ω—Ç–æ–≤
                </div>
            </div>
            {% else %}
            <div class="quest-user-badge active">
                üî• –ê–∫—Ç–∏–≤–Ω–æ
            </div>
            {% endif %}
            
            <div class="quest-header">
                <div class="quest-icon" style="background: #FF9800;">
                    ‚öôÔ∏è
                </div>
                <div class="quest-main">
                    <h3>–†–∞–±–æ—Ç–∞ —Å –ß–ü–£ —Å—Ç–∞–Ω–∫–∞–º–∏</h3>
                    <p class="quest-description">–ù–∞—É—á–∏—Ç–µ—Å—å —Å–æ–∑–¥–∞–≤–∞—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º—ã –¥–ª—è –ß–ü–£ –æ–±—Ä–∞–±–æ—Ç–∫–∏</p>
                    <div class="quest-meta">
                        <span class="meta-item"><i class="fas fa-clock"></i> 4-5 —á–∞—Å–æ–≤</span>
                        <span class="meta-item"><i class="fas fa-tasks"></i> 6 –∑–∞–¥–∞–Ω–∏–π</span>
                        {% if user.role == 'admin' %}
                        <span class="meta-item"><i class="fas fa-users"></i> 28 —Å—Ç—É–¥–µ–Ω—Ç–æ–≤</span>
                        <span class="meta-item"><i class="fas fa-chart-line"></i> 45% —É—Å–ø–µ—Ö–∞</span>
                        {% endif %}
                    </div>
                </div>
            </div>
            
            <div class="quest-progress">
                <div class="progress-info">
                    <span>–ü—Ä–æ–≥—Ä–µ—Å—Å:</span>
                    <strong>
                        {% if user.role == 'admin' %}
                            45% —É—Å–ø–µ—Ö–∞
                        {% else %}
                            30%
                        {% endif %}
                    </strong>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: {% if user.role == 'admin' %}45{% else %}30{% endif %}%; background: #FF9800;"></div>
                </div>
            </div>

            <div class="quest-footer">
                <div class="quest-rewards">
                    <strong><i class="fas fa-trophy"></i> –ù–∞–≥—Ä–∞–¥—ã:</strong>
                    <span>–î–æ–ø—É—Å–∫ –∫ –ß–ü–£ —Å—Ç–∞–Ω–∫–∞–º, +200 –æ–ø—ã—Ç–∞</span>
                </div>
                {% if user.role != 'admin' %}
                <button class="btn btn-primary" onclick="continueQuest(3)">
                    <i class="fas fa-play"></i> –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å
                </button>
                {% endif %}
            </div>
        </div>

        <!-- –ö–≤–µ—Å—Ç 4 -->
        <div class="quest-card">
            {% if user.role == 'admin' %}
            <div class="admin-quest-overlay">
                <div class="admin-quest-controls">
                    <button class="btn btn-sm btn-edit" onclick="editQuest(4)" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–≤–µ—Å—Ç">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-sm btn-stats" onclick="showQuestStats(4)" title="–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–≤–µ—Å—Ç–∞">
                        <i class="fas fa-chart-bar"></i>
                    </button>
                    <button class="btn btn-sm btn-users" onclick="showQuestUsers(4)" title="–£—á–∞—Å—Ç–Ω–∏–∫–∏ –∫–≤–µ—Å—Ç–∞">
                        <i class="fas fa-users"></i>
                    </button>
                </div>
                <div class="quest-admin-badge draft">
                    –ß–µ—Ä–Ω–æ–≤–∏–∫ ‚Ä¢ 0 —Å—Ç—É–¥–µ–Ω—Ç–æ–≤
                </div>
            </div>
            {% else %}
            <div class="quest-user-badge available">
                üîí –î–æ—Å—Ç—É–ø–Ω–æ
            </div>
            {% endif %}
            
            <div class="quest-header">
                <div class="quest-icon" style="background: #9C27B0;">
                    üöÅ
                </div>
                <div class="quest-main">
                    <h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ë–ü–õ–ê</h3>
                    <p class="quest-description">–û—Å–≤–æ–π—Ç–µ –ø–∏–ª–æ—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ—Å–ø–∏–ª–æ—Ç–Ω—ã—Ö –ª–µ—Ç–∞—Ç–µ–ª—å–Ω—ã—Ö –∞–ø–ø–∞—Ä–∞—Ç–æ–≤</p>
                    <div class="quest-meta">
                        <span class="meta-item"><i class="fas fa-clock"></i> 5-6 —á–∞—Å–æ–≤</span>
                        <span class="meta-item"><i class="fas fa-tasks"></i> 7 –∑–∞–¥–∞–Ω–∏–π</span>
                        {% if user.role == 'admin' %}
                        <span class="meta-item"><i class="fas fa-users"></i> 0 —Å—Ç—É–¥–µ–Ω—Ç–æ–≤</span>
                        <span class="meta-item"><i class="fas fa-chart-line"></i> 0% —É—Å–ø–µ—Ö–∞</span>
                        {% endif %}
                    </div>
                </div>
            </div>
            
            <div class="quest-progress">
                <div class="progress-info">
                    <span>–ü—Ä–æ–≥—Ä–µ—Å—Å:</span>
                    <strong>
                        {% if user.role == 'admin' %}
                            0% —É—Å–ø–µ—Ö–∞
                        {% else %}
                            0%
                        {% endif %}
                    </strong>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 0%; background: #9C27B0;"></div>
                </div>
            </div>

            <div class="quest-footer">
                <div class="quest-rewards">
                    <strong><i class="fas fa-trophy"></i> –ù–∞–≥—Ä–∞–¥—ã:</strong>
                    <span>–î–æ–ø—É—Å–∫ –∫ –ë–ü–õ–ê, +180 –æ–ø—ã—Ç–∞</span>
                </div>
                {% if user.role != 'admin' %}
                <button class="btn btn-primary" onclick="continueQuest(4)">
                    <i class="fas fa-play"></i> –ù–∞—á–∞—Ç—å
                </button>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ -->
{% if user and user.role == 'admin' %}
<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–∑–¥–∞–Ω–∏—è –∫–≤–µ—Å—Ç–∞ -->
<div id="addQuestModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3><i class="fas fa-plus"></i> –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –∫–≤–µ—Å—Ç</h3>
            <span class="close" onclick="closeAddQuestModal()">&times;</span>
        </div>
        <form id="addQuestForm" class="modal-form">
            <div class="form-group">
                <label>–ù–∞–∑–≤–∞–Ω–∏–µ –∫–≤–µ—Å—Ç–∞:</label>
                <input type="text" name="title" required placeholder="–û—Å–Ω–æ–≤—ã 3D-–ø–µ—á–∞—Ç–∏">
            </div>
            <div class="form-group">
                <label>–û–ø–∏—Å–∞–Ω–∏–µ:</label>
                <textarea name="description" rows="3" required placeholder="–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∫–≤–µ—Å—Ç–∞..."></textarea>
            </div>
            <div class="form-group">
                <label>–ò–∫–æ–Ω–∫–∞:</label>
                <select name="icon" required>
                    <option value="üñ®">üñ® 3D-–ø–µ—á–∞—Ç—å</option>
                    <option value="ü§ñ">ü§ñ –†–æ–±–æ—Ç—ã</option>
                    <option value="‚öôÔ∏è">‚öôÔ∏è –ß–ü–£</option>
                    <option value="üöÅ">üöÅ –ë–ü–õ–ê</option>
                    <option value="üîå">üîå –≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞</option>
                </select>
            </div>
            <div class="form-group">
                <label>–¶–≤–µ—Ç:</label>
                <input type="color" name="color" value="#4CAF50" required>
                <small style="color: #666; font-size: 0.8rem; margin-top: 0.5rem; display: block;">–í—ã–±–µ—Ä–∏—Ç–µ —Ü–≤–µ—Ç –¥–ª—è –∫–≤–µ—Å—Ç–∞</small>
            </div>
            <div class="form-group">
                <label>–û–∂–∏–¥–∞–µ–º–æ–µ –≤—Ä–µ–º—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è:</label>
                <input type="text" name="duration" placeholder="2-3 —á–∞—Å–∞" required>
            </div>
            <div class="form-actions">
                <button type="button" class="btn btn-secondary" onclick="closeAddQuestModal()">–û—Ç–º–µ–Ω–∞</button>
                <button type="submit" class="btn btn-primary">–°–æ–∑–¥–∞—Ç—å –∫–≤–µ—Å—Ç</button>
            </div>
        </form>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∫–≤–µ—Å—Ç–∞ -->
<div id="questStatsModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3><i class="fas fa-chart-bar"></i> –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–≤–µ—Å—Ç–∞</h3>
            <span class="close" onclick="closeQuestStatsModal()">&times;</span>
        </div>
        <div class="modal-body">
            <div id="questStatsContent">
                <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
        </div>
    </div>
</div>
{% endif %}

<style>
/* –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã */
.quests-page {
    max-width: 1200px;
    margin: 0 auto;
    padding: 2rem;
}

.page-header {
    text-align: center;
    margin-bottom: 3rem;
}

.page-header h1 {
    font-size: 2.5rem;
    margin-bottom: 0.5rem;
    color: #2c3e50;
    background: linear-gradient(135deg, #667eea, #764ba2);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.page-subtitle {
    font-size: 1.2rem;
    color: #666;
    max-width: 600px;
    margin: 0 auto;
}

/* –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å */
.admin-panel {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 15px;
    padding: 2rem;
    margin-bottom: 2rem;
    color: white;
    box-shadow: 0 8px 32px rgba(0,0,0,0.1);
}

.admin-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
    flex-wrap: wrap;
    gap: 1rem;
}

.admin-header h2 {
    margin: 0;
    font-size: 1.5rem;
}

.admin-stats {
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
}

.admin-badge {
    background: rgba(255,255,255,0.2);
    padding: 0.5rem 1rem;
    border-radius: 20px;
    font-size: 0.9rem;
    backdrop-filter: blur(10px);
}

.admin-controls {
    display: flex;
    gap: 1rem;
    margin-bottom: 1.5rem;
    flex-wrap: wrap;
}

.btn-admin {
    background: rgba(255,255,255,0.9);
    color: #667eea;
    border: none;
    padding: 0.75rem 1.5rem;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.btn-admin:hover {
    background: white;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
}

/* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∫–≤–µ—Å—Ç–æ–≤ */
.quests-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
    gap: 2rem;
}

/* –ö–∞—Ä—Ç–æ—á–∫–∞ –∫–≤–µ—Å—Ç–∞ */
.quest-card {
    background: white;
    border-radius: 16px;
    padding: 2rem;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    border: 1px solid #e9ecef;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.quest-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
}

.quest-card.completed {
    border-left: 4px solid #4CAF50;
}

/* –ê–¥–º–∏–Ω-–æ–≤–µ—Ä–ª–µ–π */
.admin-quest-overlay {
    position: relative;
    margin-bottom: 1rem;
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 1rem;
}

.admin-quest-controls {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
}

.quest-admin-badge {
    padding: 0.4rem 0.8rem;
    border-radius: 12px;
    font-size: 0.75rem;
    font-weight: 600;
    color: white;
    white-space: nowrap;
}

.quest-admin-badge.active {
    background: rgba(40, 167, 69, 0.9);
}

.quest-admin-badge.draft {
    background: rgba(108, 117, 125, 0.9);
}

/* –ë–µ–π–¥–∂ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π */
.quest-user-badge {
    position: absolute;
    top: 1rem;
    right: 1rem;
    padding: 0.4rem 0.8rem;
    border-radius: 12px;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    z-index: 2;
}

.quest-user-badge.completed {
    background: #E8F5E9;
    color: #2E7D32;
    border: 1px solid #C8E6C9;
}

.quest-user-badge.active {
    background: #E3F2FD;
    color: #1565C0;
    border: 1px solid #BBDEFB;
}

.quest-user-badge.available {
    background: #F3E5F5;
    color: #7B1FA2;
    border: 1px solid #E1BEE7;
}

/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∫–≤–µ—Å—Ç–∞ */
.quest-header {
    display: flex;
    align-items: flex-start;
    gap: 1.5rem;
    margin-bottom: 1.5rem;
    padding-right: 120px;
    position: relative;
}

.quest-icon {
    width: 60px;
    height: 60px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.8rem;
    color: white;
    flex-shrink: 0;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

.quest-main {
    flex: 1;
    min-width: 0;
    padding-right: 0;
}

.quest-main h3 {
    margin: 0 0 0.5rem 0;
    color: #2c3e50;
    font-size: 1.4rem;
    font-weight: 600;
    line-height: 1.3;
    word-wrap: break-word;
}

.quest-description {
    margin: 0 0 1rem 0;
    color: #666;
    line-height: 1.5;
    font-size: 0.95rem;
    word-wrap: break-word;
}

.quest-meta {
    display: flex;
    gap: 1.5rem;
    flex-wrap: wrap;
}

.meta-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: #666;
    font-size: 0.85rem;
    font-weight: 500;
    white-space: nowrap;
}

.meta-item i {
    color: #667eea;
    width: 16px;
}

/* –ü—Ä–æ–≥—Ä–µ—Å—Å –∫–≤–µ—Å—Ç–∞ */
.quest-progress {
    margin-bottom: 1.5rem;
}

.progress-info {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.5rem;
    font-size: 0.9rem;
    color: #666;
    font-weight: 500;
}

.progress-info strong {
    color: #2c3e50;
    font-weight: 600;
}

.progress-bar {
    background: #e9ecef;
    border-radius: 10px;
    height: 8px;
    overflow: hidden;
}

.progress-fill {
    height: 100%;
    border-radius: 10px;
    transition: width 0.8s ease;
}

/* –ó–∞–¥–∞–Ω–∏—è –∫–≤–µ—Å—Ç–∞ */
.quest-tasks {
    margin-bottom: 1.5rem;
}

.quest-tasks h4 {
    margin: 0 0 1rem 0;
    color: #2c3e50;
    font-size: 1.1rem;
    font-weight: 600;
}

.tasks-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 0.8rem;
}

.task-item {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem;
    border-radius: 10px;
    transition: all 0.3s ease;
    border: 1px solid #e9ecef;
    background: #f8f9fa;
    cursor: pointer;
}

.task-item:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    border-color: #667eea;
}

.task-item.reading {
    border-left: 4px solid #4CAF50;
}

.task-item.quiz {
    border-left: 4px solid #2196F3;
}

.task-item.practical {
    border-left: 4px solid #FF9800;
}

.task-item.completed {
    opacity: 0.7;
    background: #f8fff8;
}

.task-item.active {
    background: #f0f8ff;
    border-color: #2196F3;
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0% { box-shadow: 0 0 0 0 rgba(33, 150, 243, 0.4); }
    70% { box-shadow: 0 0 0 5px rgba(33, 150, 243, 0); }
    100% { box-shadow: 0 0 0 0 rgba(33, 150, 243, 0); }
}

.task-icon {
    width: 40px;
    height: 40px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: white;
    color: #667eea;
    font-size: 1.1rem;
    flex-shrink: 0;
}

.task-info {
    flex: 1;
    min-width: 0;
}

.task-name {
    font-weight: 500;
    font-size: 0.9rem;
    margin-bottom: 0.2rem;
    color: #2c3e50;
    word-wrap: break-word;
}

.task-status {
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
}

.task-status.completed { color: #27AE60; }
.task-status.active { color: #2980B9; }
.task-status:not(.completed):not(.active) { color: #7F8C8D; }

.task-stats {
    color: #666;
    font-size: 0.8rem;
}

.task-admin-actions {
    display: flex;
    gap: 0.3rem;
}

.btn-xs {
    padding: 0.3rem 0.6rem;
    font-size: 0.7rem;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.3s ease;
}

/* –§—É—Ç–µ—Ä –∫–≤–µ—Å—Ç–∞ */
.quest-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding-top: 1.5rem;
    border-top: 1px solid #f0f0f0;
    flex-wrap: wrap;
    gap: 1rem;
}

.quest-rewards {
    display: flex;
    align-items: center;
    gap: 0.8rem;
    font-size: 0.9rem;
    flex: 1;
    min-width: 0;
}

.quest-rewards strong {
    color: #2c3e50;
    white-space: nowrap;
}

.quest-rewards span {
    color: #666;
    word-wrap: break-word;
}

/* –ö–Ω–æ–ø–∫–∏ */
.btn {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1.5rem;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
    text-decoration: none;
    transition: all 0.3s ease;
    text-align: center;
    font-size: 0.9rem;
    white-space: nowrap;
}

.btn-primary {
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
}

.btn-primary:hover {
    background: linear-gradient(135deg, #5a6fd8, #6a42a0);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
}

.btn-secondary {
    background: #6c757d;
    color: white;
}

.btn-secondary:hover {
    background: #5a6268;
}

.btn-edit {
    background: #ffc107;
    color: white;
}

.btn-edit:hover {
    background: #e0a800;
    transform: scale(1.05);
}

.btn-stats {
    background: #17a2b8;
    color: white;
}

.btn-stats:hover {
    background: #138496;
    transform: scale(1.05);
}

.btn-users {
    background: #6f42c1;
    color: white;
}

.btn-users:hover {
    background: #5e36a6;
    transform: scale(1.05);
}

.btn-sm {
    padding: 0.5rem 1rem;
    font-size: 0.8rem;
}

/* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
.modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.5);
    backdrop-filter: blur(5px);
}

.modal-content {
    background-color: white;
    margin: 5% auto;
    padding: 0;
    border-radius: 20px;
    width: 90%;
    max-width: 500px;
    box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    max-height: 90vh;
    overflow-y: auto;
    animation: modalSlideIn 0.3s ease;
}

@keyframes modalSlideIn {
    from {
        opacity: 0;
        transform: translateY(-50px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.modal-header {
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
    padding: 1.5rem 2rem;
    border-radius: 20px 20px 0 0;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.modal-header h3 {
    margin: 0;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.close {
    font-size: 2rem;
    cursor: pointer;
    transition: opacity 0.3s ease;
}

.close:hover {
    opacity: 0.7;
}

.modal-form {
    padding: 2rem;
}

.modal-body {
    padding: 2rem;
}

.form-group {
    margin-bottom: 1.5rem;
}

.form-group label {
    display: block;
    margin-bottom: 0.5rem;
    font-weight: 600;
    color: #333;
}

.form-group input,
.form-group select,
.form-group textarea {
    width: 100%;
    padding: 0.75rem 1rem;
    border: 2px solid #e0e0e0;
    border-radius: 8px;
    font-size: 1rem;
    transition: border-color 0.3s ease;
    background: #f8f9fa;
}

.form-group input:focus,
.form-group select:focus,
.form-group textarea:focus {
    outline: none;
    border-color: #667eea;
    background: white;
}

.form-group input[type="color"] {
    height: 50px;
    padding: 0.5rem;
    cursor: pointer;
}

.form-actions {
    display: flex;
    gap: 1rem;
    justify-content: flex-end;
    margin-top: 2rem;
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
@media (max-width: 768px) {
    .quests-page {
        padding: 1rem;
    }
    
    .quests-container {
        grid-template-columns: 1fr;
    }
    
    .admin-header {
        flex-direction: column;
        align-items: stretch;
    }
    
    .admin-controls {
        flex-direction: column;
    }
    
    .quest-header {
        flex-direction: column;
        gap: 1rem;
        text-align: center;
    }
    
    .quest-icon {
        align-self: center;
    }
    
    .quest-meta {
        justify-content: center;
    }
    
    .quest-footer {
        flex-direction: column;
        gap: 1rem;
        align-items: stretch;
    }
    
    .admin-quest-overlay {
        flex-direction: column;
        align-items: stretch;
        gap: 0.5rem;
    }
    
    .form-actions {
        flex-direction: column;
    }
    
    .modal-content {
        margin: 10% auto;
        width: 95%;
    }
}

@media (max-width: 480px) {
    .page-header h1 {
        font-size: 2rem;
    }
    
    .quest-card {
        padding: 1.5rem;
    }
    
    .admin-panel {
        padding: 1.5rem;
    }
    
    .quest-user-badge {
        position: relative;
        top: auto;
        right: auto;
        align-self: flex-start;
        margin-bottom: 1rem;
    }
}
</style>

<script>
// ========== –§–£–ù–ö–¶–ò–ò –î–õ–Ø –ê–î–ú–ò–ù–ò–°–¢–†–ê–¢–û–†–û–í ==========
function showAddQuestModal() {
    document.getElementById('addQuestModal').style.display = 'block';
}

function closeAddQuestModal() {
    document.getElementById('addQuestModal').style.display = 'none';
}

function showQuestStats(questId) {
    // –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–∞–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
    fetch(`/admin/quests/${questId}/stats`)
        .then(response => response.json())
        .then(data => {
            document.getElementById('questStatsContent').innerHTML = `
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-value">${data.total_users}</div>
                        <div class="stat-label">–í—Å–µ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">${data.completed_users}</div>
                        <div class="stat-label">–ó–∞–≤–µ—Ä—à–∏–ª–∏ –∫–≤–µ—Å—Ç</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">${data.success_rate}%</div>
                        <div class="stat-label">–£—Å–ø–µ—à–Ω—ã—Ö –∑–∞–≤–µ—Ä—à–µ–Ω–∏–π</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">${data.avg_completion_time}</div>
                        <div class="stat-label">–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è</div>
                    </div>
                </div>
                <div class="stats-details">
                    <h4>–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è:</h4>
                    <ul>
                        ${data.popular_tasks.map(task => `<li>${task}</li>`).join('')}
                    </ul>
                    <h4>–°–ª–æ–∂–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è:</h4>
                    <ul>
                        ${data.difficult_tasks.map(task => `<li>${task}</li>`).join('')}
                    </ul>
                </div>
            `;
            document.getElementById('questStatsModal').style.display = 'block';
        })
        .catch(error => {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', error);
            showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏', 'error');
        });
}

function closeQuestStatsModal() {
    document.getElementById('questStatsModal').style.display = 'none';
}

function editQuest(questId) {
    showNotification(`–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–≤–µ—Å—Ç–∞ ${questId}`, 'info');
    // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏: window.location.href = `/admin/quests/${questId}/edit`;
}

function editTask(taskId) {
    showNotification(`–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è ${taskId}`, 'info');
    // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏: window.location.href = `/admin/tasks/${taskId}/edit`;
}

function showQuestUsers(questId) {
    showNotification(`–ü—Ä–æ—Å–º–æ—Ç—Ä —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –∫–≤–µ—Å—Ç–∞ ${questId}`, 'info');
    // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏: window.location.href = `/admin/quests/${questId}/users`;
}

function showUserProgressModal() {
    showNotification('–û—Ç–∫—Ä—ã—Ç–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π', 'success');
    // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏: window.location.href = '/admin/quests/progress';
}

function exportQuestData() {
    showNotification('–î–∞–Ω–Ω—ã–µ –∫–≤–µ—Å—Ç–æ–≤ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã', 'success');
    // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏: window.location.href = '/admin/quests/export';
}

// ========== –§–£–ù–ö–¶–ò–ò –î–õ–Ø –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ï–ô ==========
function continueQuest(questId) {
    // –ü—Ä—è–º–æ–π –ø–µ—Ä–µ—Ö–æ–¥ –±–µ–∑ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
    window.location.href = `/quest/${questId}`;
}

function openTask(taskUrl) {
    // –ü—Ä—è–º–æ–π –ø–µ—Ä–µ—Ö–æ–¥ –±–µ–∑ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
    window.location.href = taskUrl;
}

// ========== –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –§–û–†–ú ==========
document.getElementById('addQuestForm')?.addEventListener('submit', function(e) {
    e.preventDefault();
    const formData = new FormData(this);
    const questData = Object.fromEntries(formData);
    
    showNotification(`–ö–≤–µ—Å—Ç "${questData.title}" —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ!`, 'success');
    closeAddQuestModal();
    
    // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç AJAX –∑–∞–ø—Ä–æ—Å:
    // fetch('/admin/quests/create', {
    //     method: 'POST',
    //     headers: {'Content-Type': 'application/json'},
    //     body: JSON.stringify(questData)
    // })
});

// ========== –û–ë–©–ò–ï –§–£–ù–ö–¶–ò–ò ==========
function showNotification(message, type = 'info') {
    const notification = document.createElement('div');
    notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 1rem 1.5rem;
        background: ${type === 'success' ? '#28a745' : type === 'error' ? '#dc3545' : '#667eea'};
        color: white;
        border-radius: 8px;
        z-index: 10000;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        font-weight: 500;
        max-width: 300px;
        transform: translateX(400px);
        transition: transform 0.3s ease;
    `;
    notification.textContent = message;
    document.body.appendChild(notification);
    
    // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è
    setTimeout(() => {
        notification.style.transform = 'translateX(0)';
    }, 100);
    
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∫—Ä—ã—Ç–∏–µ
    setTimeout(() => {
        notification.style.transform = 'translateX(400px)';
        setTimeout(() => {
            if (notification.parentNode) {
                notification.parentNode.removeChild(notification);
            }
        }, 300);
    }, 3000);
}

// –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω
window.addEventListener('click', function(event) {
    const modals = document.querySelectorAll('.modal');
    modals.forEach(modal => {
        if (event.target === modal) {
            modal.style.display = 'none';
        }
    });
});

// –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ ESC
document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        const modals = document.querySelectorAll('.modal');
        modals.forEach(modal => {
            modal.style.display = 'none';
        });
    }
});

// –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫
document.addEventListener('DOMContentLoaded', function() {
    const cards = document.querySelectorAll('.quest-card');
    cards.forEach((card, index) => {
        card.style.opacity = '0';
        card.style.transform = 'translateY(20px)';
        
        setTimeout(() => {
            card.style.transition = 'all 0.5s ease';
            card.style.opacity = '1';
            card.style.transform = 'translateY(0)';
        }, index * 100);
    });
});
</script>
{% endblock %}